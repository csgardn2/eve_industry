/// @file invent.h
/// @brief Declaration of @ref invent_t class
/// 
/// * Contact conor.gardner@arm.com if you have questions about this code.
/// * Date Created = Friday November 24 2017
/// * Documentation is generated by doxygen, see html/index.html

#ifndef HEADER_GUARD_INVENT
#define HEADER_GUARD_INVENT

// Don't include anything
// Let blueprint.h include all your files
// This way you won't actually make any extra inner classes accidently.

/// @brief All of the blueprint attributes related to invention runs.
class invent_t
{
        
    public:
        
        /// @brief Default constructor
        inline invent_t() = default;
        
        // Add member initialization constructors here
        // Try to use initializer lists when possible.
        
        // Add operators here if desired.
        
        // Add member read and write functions
        
        inline bool valid() const
        {
            return this->valid_;
        }
        
        inline void valid(bool new_valid)
        {
            this->valid_ = new_valid;
        }
        
        inline unsigned time() const
        {
            if (!this->valid_)
                throw error_message_t(error_code_t::READ_INVALID_INVENT, "Error.  Tried to read blueprint_t::invent_t::time_ from an invalid object.\n");
            return this->time_;
        }
        
        inline void time(unsigned new_time)
        {
            this->time_ = new_time;
        }
        
        inline float probability() const
        {
            if (!this->valid_)
                throw error_message_t(error_code_t::READ_INVALID_INVENT, "Error.  Tried to read blueprint_t::invent_t::probability_ from an invalid object.\n");
            return this->probability_;
        }
        
        void probability(float new_probability);
        
        inline const item_quantities_t& input_materials() const
        {
            if (!this->valid_)
                throw error_message_t(error_code_t::READ_INVALID_INVENT, "Error.  Tried to read blueprint_t::invent_t::input_materials_ from an invalid object.\n");
            return this->input_materials_;
        }
        
        inline item_quantities_t& input_materials()
        {
            return this->input_materials_;
        }
        
        inline uint64_t invented_from_blueprint_id() const
        {
            if (!this->valid_)
                throw error_message_t(error_code_t::READ_INVALID_INVENT, "Error.  Tried to read blueprint_t::invent_t::invented_from_blueprint_id_ from an invalid object.\n");
            return this->invented_from_blueprint_id_;
        }
        
        inline void invented_from_blueprint_id(uint64_t new_invented_from_blueprint_id)
        {
            this->invented_from_blueprint_id_ = new_invented_from_blueprint_id;
        }
        
        inline unsigned material_efficiency() const
        {
            if (!this->valid_)
                throw error_message_t(error_code_t::READ_INVALID_INVENT, "Error.  Tried to read blueprint_t::invent_t::material_efficiency_ from an invalid object.\n");
            return this->material_efficiency_;
        }
        
        inline void material_efficiency(unsigned new_material_efficiency)
        {
            validate_material_efficiency(new_material_efficiency);
            this->material_efficiency_ = new_material_efficiency;
        }
        
        inline unsigned time_efficiency() const
        {
            if (!this->valid_)
                throw error_message_t(error_code_t::READ_INVALID_INVENT, "Error.  Tried to read blueprint_t::invent_t::time_efficiency_ from an invalid object.\n");
            return this->time_efficiency_;
        }
        
        inline void time_efficiency(unsigned new_time_efficiency)
        {
            validate_time_efficiency(new_time_efficiency);
            this->time_efficiency_ = new_time_efficiency;
        }
        
        inline unsigned runs() const
        {
            if (!this->valid_)
                throw error_message_t(error_code_t::READ_INVALID_INVENT, "Error.  Tried to read blueprint_t::invent_t::runs_ from an invalid object.\n");
            return this->runs_;
        }
        
        inline void runs(unsigned new_runs)
        {
            this->runs_ = new_runs;
        }
        
        // Add special-purpose functions here
        
        // Add encoders/decoders here
        
        /// @brief Open a file conforming to data/json/schema.json and use it to initialize
        /// this object, clearing previous content.
        ///
        /// @exception error_message_t
        /// @exception Json::Exception
        void read_from_json_file(std::istream& file);
        
        /// @brief Decode serialized content conforming to data/json/schema.json and use it
        /// to initialize this object, clearing previous content.
        ///
        /// @exception error_message_t
        /// @exception Json::Exception
        void read_from_json_buffer(std::string_view buffer);
        
        /// @brief Extract required data fields from a pre-parsed JSON tree
        /// and use them to initialize this object, clearing previous content.
        ///
        /// @exception error_message_t
        void read_from_json_structure(const Json::Value& json_root);
        
        /// @brief Serialize the content of this file into a file that
        /// conforms to the schema data/json/schema.json.
        void write_to_json_file
        (
            /// [out] Stream to append serialized object content to.
            std::ostream& file,
            /// [in] The number of space ' ' characters to prepend to each line
            /// in the serialized output.
            unsigned indent_start = 0,
            /// [in] The number of additional spaces ' ' on top of indent_start
            /// to prepend to each line in the serialized output for each
            /// additional level of nesting.
            ///
            /// Indentation typically increases after each opening bracket '['
            /// or brace '{' and decreases after each closing bracket ']' or
            /// brace '}'.
            unsigned spaces_per_tab = 4
        ) const;
        
        /// @brief Serialize the content of this file into a string that
        /// conforms to the schema data/json/schema.json.
        ///
        /// @exception error_message_t
        void write_to_json_buffer
        (
            /// [out] This string is overwritten with serialzed JSON content.
            std::string& buffer,
            /// [in] The number of space ' ' characters to prepend to each line
            /// in the serialized output.
            unsigned indent_start = 0,
            /// [in] The number of additional spaces ' ' on top of indent_start
            /// to prepend to each line in the serialized output for each
            /// additional level of nesting.
            ///
            /// Indentation typically increases after each opening bracket '['
            /// or brace '{' and decreases after each closing bracket ']' or
            /// brace '}'.
            unsigned spaces_per_tab = 4
        ) const;
        
    protected:
        
        // Try to make your members protected, even if they don't have to be.
        
        /// @brief Set to true if this is a T2 blueprint that can be invented
        /// from a T1 blueprint.  False otherwise.
        ///
        /// A value of false indicates that an invent field was not found while
        /// decoding a @ref blueprint_t.
        ///
        /// A value of false also indicates that this invent field should not be
        /// encoded when writing a blueprint_t.
        bool valid_;
        
        /// @brief The number of seconds required to perform an invention run on
        /// a single 1-run input blueprint.
        unsigned time_;
        
        /// @brief The probability of successfully inventing this blueprint with
        /// no skills, bonuses, or decryptors.
        ///
        /// Valid values range from [0.0f to 1.0f].
        float probability_;
        
        /// @brief List of materials and datacores but NOT decryptors and their
        /// quantities consumed when inventing a single 1-run BPC.
        item_quantities_t input_materials_;
        
        /// @brief Integral ID of the T1 blueprint copy used to produce this T2 blueprint.
        uint64_t invented_from_blueprint_id_;
        
        /// @brief Material efficiency of the resultant T2 blueprint with no decryptors.
        ///
        /// Valid values range from [0 to 10].
        unsigned material_efficiency_;
        
        /// @brief Time efficiency of the resultant T2 blueprint with no decryptors.
        ///
        /// Valid values range from [0 to 20].
        unsigned time_efficiency_;
        
        /// @brief Runs per copy for a single output T2 blueprint with no decryptors.
        unsigned runs_;
        
};

#endif // Header Guard

